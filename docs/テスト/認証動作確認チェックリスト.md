# Google認証機能 動作確認チェックリスト

## 確認環境

- **確認日**: _______________
- **確認者**: _______________
- **ブラウザ**: Chrome / Firefox / Safari / Edge
- **バージョン**: _______________
- **OS**: Windows / macOS / Linux / iOS / Android
- **環境**: 開発環境 / ステージング環境 / 本番環境
- **Googleアカウント**: _______________

---

## 1. ログインボタンの表示

### 1.1 ヘッダーでのログインボタン表示

#### 未ログイン時のヘッダー表示
- [ ] ヘッダーに「ログイン」ボタンが表示されている
- [ ] 「ログイン」ボタンがプライマリカラーで表示されている
- [ ] 「ログイン」ボタンが適切なサイズで表示されている
- [ ] 「ログイン」ボタンをクリックすると`/auth/signin`に遷移する

#### レスポンシブ表示
- [ ] PC（デスクトップ）で「ログイン」ボタンが正しく表示される
- [ ] タブレットで「ログイン」ボタンが正しく表示される
- [ ] スマートフォンで「ログイン」ボタンが正しく表示される

---

### 1.2 ログイン画面でのログインボタン表示

#### ページアクセス
- [ ] `/auth/signin`にアクセスできる
- [ ] ページが正しく表示される
- [ ] ページタイトルが「ログイン」になっている
- [ ] 背景色が`background.default`で表示されている
- [ ] Containerが最大幅で制限されている

#### Googleログインボタンの表示
- [ ] 「Googleでログイン」ボタンが表示されている
- [ ] ボタンにGoogleアイコンが表示されている
- [ ] ボタンがGoogleのブランドカラー（#4285F4）で表示されている
- [ ] ボタンが全幅で表示されている
- [ ] ボタンサイズが`large`で表示されている
- [ ] ボタンに適切なパディングが設定されている
- [ ] ホバー時に色が変わる（#357AE8）

#### 説明文の表示
- [ ] 「Googleアカウントで簡単にログインできます」という説明文が表示されている
- [ ] 説明文が中央揃えになっている
- [ ] 利用規約とプライバシーポリシーの注意書きが表示されている

#### ナビゲーション
- [ ] 「ホームに戻る」ボタンが表示されている
- [ ] 「ホームに戻る」ボタンにArrowBackアイコンが表示されている
- [ ] 「ホームに戻る」ボタンをクリックすると`/`に遷移する

---

## 2. ログインボタンクリックでGoogleログイン画面に遷移

### 2.1 Googleログインボタンのクリック

#### ボタンクリック動作
- [ ] 「Googleでログイン」ボタンをクリックする
- [ ] ボタンがクリック可能な状態になっている
- [ ] クリック時に適切なフィードバックが表示される

#### Google認証画面への遷移
- [ ] クリック後、Google認証画面にリダイレクトされる
- [ ] リダイレクトがスムーズに行われる
- [ ] URLがGoogleの認証ページに変更される
- [ ] ブラウザのアドレスバーにGoogleのドメインが表示される

---

### 2.2 Google認証画面の表示

#### 認証画面の基本表示
- [ ] Google認証画面が正しく表示される
- [ ] アプリケーション名が表示されている
- [ ] アプリケーションのロゴが表示されている（設定されている場合）
- [ ] アプリケーションが要求する権限が表示されている

#### アカウント選択画面
- [ ] Googleアカウントの選択画面が表示される
- [ ] 複数のGoogleアカウントが表示される（複数アカウントがある場合）
- [ ] アカウント選択が可能になっている

---

## 3. Googleアカウント選択後、アプリにリダイレクト

### 3.1 アカウント選択と認証

#### アカウント選択
- [ ] Googleアカウントを選択する
- [ ] アカウント選択が正常に完了する

#### 認証許可
- [ ] アプリケーションへのアクセス許可を確認する画面が表示される
- [ ] 「許可」ボタンをクリックする
- [ ] 認証が正常に完了する

---

### 3.2 アプリケーションへのリダイレクト

#### リダイレクト処理
- [ ] Google認証後、アプリケーションにリダイレクトされる
- [ ] リダイレクトURLが`/api/auth/callback/google`になっている
- [ ] リダイレクトがスムーズに行われる
- [ ] 認証コードが正しく処理される

#### リダイレクト後の処理
- [ ] 認証コードがトークンに交換される
- [ ] Google APIからユーザー情報が取得される
- [ ] ユーザー情報が正しく取得される（名前、メールアドレス、画像URL）

---

## 4. ログイン成功後、ダッシュボードに遷移

### 4.1 ダッシュボードへの遷移

#### ページ遷移
- [ ] ログイン成功後、`/dashboard`にリダイレクトされる
- [ ] リダイレクトがスムーズに行われる
- [ ] ブラウザの履歴に正しく記録される
- [ ] URLが`/dashboard`になっている

#### ダッシュボードページの表示
- [ ] ダッシュボードページが正しく表示される
- [ ] ページが読み込まれるまでローディング状態が表示される
- [ ] ページタイトルが「ダッシュボード」になっている
- [ ] 背景色が`background.default`で表示されている

---

### 4.2 ダッシュボードの内容表示

#### ウェルカムメッセージ
- [ ] 「ようこそ、{ユーザー名}さん！」というメッセージが表示されている
- [ ] ユーザー名が正しく表示されている
- [ ] メッセージが中央揃えになっている

#### ユーザー情報の表示
- [ ] ユーザーのアバターが表示されている
- [ ] アバター画像が正しく表示される（画像がある場合）
- [ ] アバターにイニシャルが表示される（画像がない場合）
- [ ] ユーザー名が表示されている
- [ ] メールアドレスが表示されている
- [ ] ユーザーロールが表示されている（「ユーザー」または「管理者」）

#### ナビゲーション
- [ ] 「ホームに戻る」ボタンが表示されている
- [ ] 「ホームに戻る」ボタンにHomeアイコンが表示されている
- [ ] 「ホームに戻る」ボタンをクリックすると`/`に遷移する

---

## 5. ヘッダーにユーザー名とアバター表示

### 5.1 ログイン後のヘッダー表示

#### ユーザー情報の表示
- [ ] ヘッダーにユーザーのアバターが表示されている
- [ ] アバター画像が正しく表示される（画像がある場合）
- [ ] アバターにイニシャルが表示される（画像がない場合）
- [ ] アバターサイズが適切（32px）で表示されている
- [ ] ユーザー名がアバターの横に表示されている
- [ ] ユーザー名が正しく表示されている

#### アカウントメニュー
- [ ] アカウントアイコン（AccountCircle）が表示されている
- [ ] アカウントアイコンをクリックするとメニューが開く
- [ ] メニューに「ダッシュボード」項目が表示されている
- [ ] メニューに「ログアウト」項目が表示されている

---

### 5.2 レスポンシブ表示

#### PC（デスクトップ）表示
- [ ] アバターとユーザー名が横並びで表示される
- [ ] アカウントメニューアイコンが表示される
- [ ] すべての要素が適切に配置されている

#### タブレット表示
- [ ] アバターとユーザー名が適切に表示される
- [ ] レイアウトが適切に調整されている

#### スマートフォン表示
- [ ] ユーザー名が非表示になる（`xs: 'none', sm: 'flex'`）
- [ ] アバターとアカウントメニューアイコンが表示される
- [ ] レイアウトが適切に調整されている

---

## 6. ログアウトボタンクリックでログアウト

### 6.1 ログアウトボタンの表示とクリック

#### ログアウトメニューの表示
- [ ] アカウントアイコンをクリックする
- [ ] メニューが開く
- [ ] 「ログアウト」項目が表示されている
- [ ] 「ログアウト」項目をクリックする

#### ログアウト処理
- [ ] ログアウト処理が開始される
- [ ] セッションが破棄される
- [ ] クッキーが削除される
- [ ] ログアウト処理が正常に完了する

---

### 6.2 ログアウト後の状態確認

#### セッションの破棄
- [ ] セッション情報が削除される
- [ ] `useSession`でセッションが`null`になる
- [ ] 認証状態が`unauthenticated`になる

#### ヘッダーの変更
- [ ] ヘッダーのユーザー情報が非表示になる
- [ ] ヘッダーに「ログイン」ボタンが表示される
- [ ] アカウントメニューが表示されなくなる

---

## 7. ログアウト後、トップページにリダイレクト

### 7.1 トップページへのリダイレクト

#### ページ遷移
- [ ] ログアウト後、`/`（トップページ）にリダイレクトされる
- [ ] リダイレクトがスムーズに行われる
- [ ] ブラウザの履歴に正しく記録される
- [ ] URLが`/`になっている

#### トップページの表示
- [ ] トップページが正しく表示される
- [ ] ページが読み込まれるまでローディング状態が表示される
- [ ] ヘッダーに「ログイン」ボタンが表示されている
- [ ] ユーザー情報が表示されていない

---

### 7.2 ログアウト後のアクセス制限

#### 保護ページへのアクセス試行
- [ ] ログアウト後、`/dashboard`に直接アクセスしようとする
- [ ] ログイン画面（`/auth/signin`）にリダイレクトされる
- [ ] 元のURL（`/dashboard`）が`callbackUrl`パラメータに保存される

---

## 8. 未認証で/dashboardアクセス時、ログイン画面にリダイレクト

### 8.1 ミドルウェアによる保護

#### 未認証ユーザーのアクセス試行
- [ ] ログアウト状態で`/dashboard`に直接アクセスする
- [ ] ブラウザのアドレスバーに`/dashboard`を入力してEnterキーを押す
- [ ] リクエストがミドルウェアによってインターセプトされる

#### ログイン画面へのリダイレクト
- [ ] `/auth/signin`にリダイレクトされる
- [ ] リダイレクトがスムーズに行われる
- [ ] URLが`/auth/signin?callbackUrl=/dashboard`になっている
- [ ] `callbackUrl`パラメータに元のURLが保存されている

---

### 8.2 ログイン後のリダイレクト確認

#### コールバックURLの処理
- [ ] ログイン画面でGoogleログインを実行する
- [ ] ログイン成功後、`callbackUrl`で指定された`/dashboard`にリダイレクトされる
- [ ] ダッシュボードページが正しく表示される

#### コールバックURLがない場合
- [ ] `callbackUrl`パラメータがない状態でログインする
- [ ] ログイン成功後、デフォルトの`/dashboard`にリダイレクトされる

---

## 9. MongoDBにユーザー情報が保存されている

### 9.1 データ保存の基本確認

#### 初回ログイン時のデータ保存
- [ ] Google認証で初回ログインする
- [ ] MongoDBにユーザー情報が保存される
- [ ] データ保存がエラーなく完了する
- [ ] `users`コレクションにデータが保存される

#### データ保存タイミング
- [ ] ログイン処理中にデータが保存される
- [ ] データ保存が遅延なく行われる
- [ ] データ保存が完了してからダッシュボードにリダイレクトされる

---

### 9.2 保存データの内容確認

#### 名前フィールド
- [ ] 保存されたデータの`name`フィールドが正しい
- [ ] Googleアカウントの名前が正しく保存されている
- [ ] 名前の前後の空白（trim）が削除されている
- [ ] 名前が100文字以内で保存されている

#### メールアドレスフィールド
- [ ] 保存されたデータの`email`フィールドが正しい
- [ ] Googleアカウントのメールアドレスが正しく保存されている
- [ ] メールアドレスの前後の空白（trim）が削除されている
- [ ] メールアドレスが小文字（lowercase）に変換されている
- [ ] メールアドレスが255文字以内で保存されている
- [ ] `email`フィールドがユニーク制約を満たしている

#### 画像URLフィールド
- [ ] 保存されたデータの`image`フィールドが存在する（画像がある場合）
- [ ] Googleアカウントのプロフィール画像URLが正しく保存されている
- [ ] 画像URLが500文字以内で保存されている
- [ ] 画像がない場合、`image`フィールドが`null`または未設定になっている

#### ロールフィールド
- [ ] 保存されたデータの`role`フィールドが存在する
- [ ] `role`フィールドが`'user'`に設定されている（デフォルト値）
- [ ] `role`フィールドが`'user'`または`'admin'`のいずれかになっている

#### 作成日時フィールド
- [ ] 保存されたデータの`createdAt`フィールドが存在する
- [ ] `createdAt`が現在の日時に近い値になっている
- [ ] `createdAt`がDate型で保存されている

#### 更新日時フィールド
- [ ] 保存されたデータの`updatedAt`フィールドが存在する
- [ ] `updatedAt`が現在の日時に近い値になっている
- [ ] `updatedAt`がDate型で保存されている

---

### 9.3 既存ユーザーのログイン時の動作

#### 既存ユーザーのログイン
- [ ] 既にMongoDBに保存されているユーザーでログインする
- [ ] 新しいユーザーレコードが作成されない
- [ ] 既存のユーザーレコードが使用される
- [ ] セッションが正しく作成される

#### ユーザー情報の更新
- [ ] 既存ユーザーでログインする
- [ ] 必要に応じてユーザー情報が更新される（name, image）
- [ ] `updatedAt`フィールドが更新される

---

### 9.4 データベース接続の確認

#### MongoDB接続
- [ ] MongoDBへの接続が正常に確立される
- [ ] 接続エラーが発生しない
- [ ] 接続プールが適切に管理されている
- [ ] 開発環境で接続が再利用される

#### コレクション・モデル
- [ ] `users`コレクションにデータが保存される
- [ ] MongoDBアダプターが正しく使用されている
- [ ] スキーマバリデーションが正しく機能している

---

## 10. その他の確認項目

### 10.1 セッション管理

#### セッションの作成
- [ ] ログイン成功後、セッションが作成される
- [ ] セッション情報にユーザーIDが含まれている
- [ ] セッション情報にユーザー名が含まれている
- [ ] セッション情報にメールアドレスが含まれている
- [ ] セッション情報に画像URLが含まれている（画像がある場合）
- [ ] セッション情報にロールが含まれている

#### セッションの取得
- [ ] `useSession`フックでセッション情報が取得できる
- [ ] セッション情報が正しく表示される
- [ ] セッション情報がリアルタイムで更新される

#### セッションの有効期限
- [ ] セッションが適切な期間有効である
- [ ] セッションが自動的に更新される（必要に応じて）

---

### 10.2 エラーハンドリング

#### 認証エラー
- [ ] Google認証が失敗した場合、適切なエラーメッセージが表示される
- [ ] エラーメッセージがユーザーに分かりやすい内容になっている
- [ ] エラー時にログイン画面に戻る

#### ネットワークエラー
- [ ] ネットワークエラーが発生した場合、適切なエラーメッセージが表示される
- [ ] エラーメッセージがフォーム上部に表示される

#### データベースエラー
- [ ] MongoDB接続エラーが発生した場合、適切なエラーメッセージが表示される
- [ ] エラーログがサーバー側に記録される

---

### 10.3 パフォーマンス

#### ページ読み込み速度
- [ ] ログイン画面の読み込み速度が適切（3秒以内）
- [ ] ダッシュボードページの読み込み速度が適切（3秒以内）

#### 認証処理速度
- [ ] Google認証処理が適切な時間内に完了する（5秒以内）
- [ ] データベースへの保存が適切な時間内に完了する
- [ ] セッション作成が適切な時間内に完了する

---

### 10.4 アクセシビリティ

#### キーボード操作
- [ ] すべてのボタンがキーボードで操作可能
- [ ] Tabキーで要素間を移動できる
- [ ] Enterキーでボタンをクリックできる
- [ ] フォーカスインジケーターが表示される

#### スクリーンリーダー
- [ ] スクリーンリーダーでログイン画面が読み上げられる
- [ ] ボタンとラベルが適切に関連付けられている
- [ ] エラーメッセージが適切に読み上げられる

#### コントラスト比
- [ ] テキストと背景のコントラスト比がWCAG AA基準を満たしている
- [ ] ボタンが十分なコントラストで表示される

---

### 10.5 セキュリティ

#### OAuth 2.0認証フロー
- [ ] OAuth 2.0認証フローが正しく実装されている
- [ ] 認証コードがトークンに正しく交換される
- [ ] トークンが安全に管理されている

#### セッション管理
- [ ] セッション情報が暗号化されている
- [ ] セッションクッキーが適切に設定されている
- [ ] CSRF対策が機能している（NextAuth.js標準機能）

#### ユーザー情報の保護
- [ ] ユーザー情報が適切に保護されている
- [ ] パスワードなどの機密情報が保存されていない
- [ ] メールアドレスが適切に管理されている

---

### 10.6 ブラウザ互換性

#### Chrome
- [ ] Chromeで正常に動作する
- [ ] ログイン処理が正常に動作する
- [ ] セッション管理が正常に動作する

#### Firefox
- [ ] Firefoxで正常に動作する
- [ ] ログイン処理が正常に動作する
- [ ] セッション管理が正常に動作する

#### Safari
- [ ] Safariで正常に動作する
- [ ] ログイン処理が正常に動作する
- [ ] セッション管理が正常に動作する

#### Edge
- [ ] Edgeで正常に動作する
- [ ] ログイン処理が正常に動作する
- [ ] セッション管理が正常に動作する

---

### 10.7 コンソールエラー確認

#### クライアント側エラー
- [ ] ブラウザのコンソールにエラーが表示されない
- [ ] 警告メッセージが適切に処理されている
- [ ] Reactの警告が表示されない

#### ネットワークエラー
- [ ] ネットワークタブにエラーが表示されない
- [ ] APIリクエストが正常に送信されている
- [ ] 認証リクエストが正常に完了している

---

## 確認結果サマリー

### 確認完了項目数
- 総項目数: _______________
- 合格項目数: _______________
- 不合格項目数: _______________

### 発見された問題

#### 重大な問題（Critical）
1. _______________
2. _______________
3. _______________

#### 中程度の問題（Major）
1. _______________
2. _______________
3. _______________

#### 軽微な問題（Minor）
1. _______________
2. _______________
3. _______________

### 改善提案
1. _______________
2. _______________
3. _______________

### 確認者コメント
_______________
_______________
_______________

---

## 確認完了

- [ ] すべての確認項目を完了した
- [ ] 発見された問題を記録した
- [ ] 改善提案を記録した
- [ ] 確認結果を関係者に共有した

**確認日**: _______________  
**確認者署名**: _______________
